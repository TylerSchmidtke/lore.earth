<!DOCTYPE html>
<html lang="{%- if lang != config.default_language %}{{ lang }}{% else %}{{ config.extra.language_code | default(value=lang) }}{% endif %}">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>{{ page.title | default(value=config.title) | safe }}</title>
  <meta name="description" content="{{ page.description | default(value=config.description) | safe }}">

  <meta property="og:site_name" content="{{ config.title }}">
  <meta property="og:title" content="{{ page.title | default(value=config.title) | safe }}">
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{ current_url }}">

  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/style.css" />
  {%- if config.extra.theme_color %}
    <link rel="stylesheet" href="{{ get_url(path="/color/" ~ config.extra.theme_color ~ ".css", trailing_slash=false) | safe }}">
  {% else %}
      <link rel="stylesheet" href="{{ get_url(path="/color/red.css", trailing_slash=false) | safe }}">
  {% endif -%}
</head>

<body>
  <header class="site-header">
    <div class="wrapper">
      <nav class="title-nav">
        <div class="trigger">
          <a class="page-link-title" href="{{ config.base_url }}/">{{ config.title }}</a>
        </div>
      </nav>

      {% block header_menu %}
      <nav class="site-nav">
        {%- if config.extra.menu_items %}
        {%- set menu_items = config.extra.menu_items -%}
        {%- for item in menu_items %}
        <a class="page-link" href="{{ item.url | safe }}">{{ item.name
          | safe }}</a>
        {% endfor -%}
        {% endif -%}
        {% block search %}
        {%- if config.build_search_index %}
        <div class="site-nav">
          <input class="search" id="search" type="text" placeholder="Search">
        </div>
        <div class="search-results">
          <div class="search-results__items"></div>
        </div>
        {%- endif %}
        {%- if config.build_search_index -%}
          {%- if config.search.index_format -%}
              {%- set search_index_format = config.search.index_format -%}
          {%- else -%}
              {%- set search_index_format = "elasticlunr_json" -%}
          {%- endif -%}

          {%- if search_index_format == "elasticlunr_javascript" -%}
              <script defer src="{{ get_url(path='search_index.' ~ lang ~ '.js', cachebust=true) | safe }}"></script>
          {%- endif -%}

          {# Main search scripts #}
          <script defer src="{{ get_url(path='/elasticlunr.min.js', cachebust=true) | safe }}"></script>
          <script defer src="{{ get_url(path='/search.js', cachebust=true) | safe }}"></script>
        {%- endif -%}
        {% endblock search %}
      </nav>
      {% endblock header_menu %}
    </div>
  </header>
  <div class="page-content">
    <div class="wrapper">
      {% block content %}
      {% endblock content %}
    </div>
  </div>
  <footer class="site-footer">

    <div class="wrapper">
      {%- if config.author %}
      <span>Â© {{ now() | date(format="%Y") }} {{ config.author }}</span>
      {% endif -%}
    </div>

  </footer>
  <!-- optional scripts -->
  {% block scripts %}
  {% endblock scripts %}

  {%- if page.extra.audio %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>

  <!-- Audio player script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const audioData = [];
      const audioPlayers = document.querySelectorAll('.audio-player');

      audioPlayers.forEach((player, index) => {
        const audioId = player.dataset.audioId;
        const playBtn = player.querySelector('.play-btn');
        const progressFill = player.querySelector('.progress-fill');
        const progressBar = player.querySelector('.progress-bar');
        const currentTimeEl = player.querySelector('.current-time');
        const durationEl = player.querySelector('.duration');
        const rewindBtn = player.querySelector('.rewind-btn');
        const fastForwardBtn = player.querySelector('.fast-forward-btn');

        const downloadBtn = player.querySelector('.download-btn');

        let howl = null;
        let isInitialized = false;

        // Initialize Howler instance on first interaction
        function initializeHowl() {
          if (!isInitialized) {
            howl = new Howl({
              src: [downloadBtn.href],
              html5: true,
              preload: false,
              onload: function() {
                const duration = howl.duration();
                durationEl.textContent = formatTime(duration);
              },
              onplay: function() {
                playBtn.querySelector('.play-icon').style.display = 'none';
                playBtn.querySelector('.pause-icon').style.display = 'block';
                requestAnimationFrame(updateProgress);
              },
              onpause: function() {
                playBtn.querySelector('.play-icon').style.display = 'block';
                playBtn.querySelector('.pause-icon').style.display = 'none';
              },
              onend: function() {
                playBtn.querySelector('.play-icon').style.display = 'block';
                playBtn.querySelector('.pause-icon').style.display = 'none';
                progressFill.style.width = '0%';
                currentTimeEl.textContent = '0:00';
              }
            });
            audioData[audioId] = howl;
            isInitialized = true;
          }
        }

        // Play/pause button
        playBtn.addEventListener('click', function() {
          initializeHowl();

          if (howl && howl.playing()) {
            howl.pause();
          } else {
            // Pause all other audio players
            audioData.forEach((otherHowl, otherIndex) => {
              if (otherIndex != audioId && otherHowl && otherHowl.playing()) {
                otherHowl.pause();
              }
            });
            if (howl) {
              howl.play();
            }
          }
        });

        // Progress bar click to seek
        progressBar.addEventListener('click', function(e) {
          if (!isInitialized) return;

          const rect = progressBar.getBoundingClientRect();
          const clickX = e.clientX - rect.left;
          const percentage = clickX / rect.width;
          const duration = howl.duration();
          const newTime = duration * percentage;
          howl.seek(newTime);
        });

        // Rewind button (10 seconds)
        rewindBtn.addEventListener('click', function() {
          if (!isInitialized) return;

          const currentSeek = howl.seek();
          const newSeek = Math.max(0, currentSeek - 10);
          howl.seek(newSeek);
        });

        // Fast forward button (10 seconds)
        fastForwardBtn.addEventListener('click', function() {
          if (!isInitialized) return;

          const currentSeek = howl.seek();
          const duration = howl.duration();
          const newSeek = Math.min(duration, currentSeek + 10);
          howl.seek(newSeek);
        });

        // Update progress
        function updateProgress() {
          if (howl && howl.playing()) {
            const seek = howl.seek();
            const duration = howl.duration();
            const percentage = (seek / duration) * 100;
            progressFill.style.width = percentage + '%';
            currentTimeEl.textContent = formatTime(seek);
            requestAnimationFrame(updateProgress);
          }
        }

        // Format time helper
        function formatTime(seconds) {
          const mins = Math.floor(seconds / 60);
          const secs = Math.floor(seconds % 60);
          return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }
      });
    });
  </script>
  {% endif -%}

</body>

</html>
